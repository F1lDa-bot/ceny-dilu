<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-T">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B2B Ceník Oprav</title>
    <!-- Tailwind CSS pro moderní vzhled -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PapaParse pro snadné zpracování CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        /* Základní styly pro lepší vzhled a dojem */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Animace pro načítací lištu */
        .progress-bar-value {
            transition: width 0.5s ease-in-out;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8">

        <!-- Hlavička aplikace -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Ceník Oprav Zařízení</h1>
            <p class="text-gray-600 mt-2">Vyberte zařízení pro zobrazení cen oprav jednotlivých komponent.</p>
        </header>

        <!-- Sekce pro načítání dat -->
        <div id="loading-section" class="w-full">
            <p class="text-center text-lg font-medium mb-2">Načítání dat z databáze...</p>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div id="progress-bar" class="bg-blue-600 h-4 rounded-full progress-bar-value" style="width: 0%"></div>
            </div>
            <p id="progress-text" class="text-center text-sm text-gray-500 mt-2">0%</p>
        </div>

        <!-- Hlavní obsah aplikace (zpočátku skrytý) -->
        <main id="app-content" class="hidden">
            <!-- Výběr zařízení -->
            <div class="mb-6">
                <label for="device-select" class="block text-lg font-medium text-gray-700 mb-2">Vyberte zařízení:</label>
                <select id="device-select" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    <option value="">-- Zvolte model --</option>
                </select>
            </div>

            <!-- Kontejner pro zobrazení výsledků -->
            <div id="result-container" class="mt-8">
                <!-- Zde se dynamicky zobrazí informace o vybraném zařízení a tabulka s cenami -->
            </div>
        </main>

    </div>

    <script>
        // --- KONFIGURACE ---
        // Vložte sem odkaz na váš publikovaný CSV soubor z Google Sheets
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQvnnYedZNOgB7B_n6P7S21BVmparjOOOgwRZlLUaRVHnb0b5bKyCQP0jmcTLxmHmfL2NONLGHDpMX9/pub?gid=1338732835&single=true&output=csv';

        // --- ELEMENTY DOM ---
        const loadingSection = document.getElementById('loading-section');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const appContent = document.getElementById('app-content');
        const deviceSelect = document.getElementById('device-select');
        const resultContainer = document.getElementById('result-container');

        let repairData = []; // Globální proměnná pro uložení dat

        // --- HLAVNÍ FUNKCE ---

        /**
         * Načte a zpracuje data z CSV souboru.
         */
        function fetchData() {
            Papa.parse(CSV_URL, {
                download: true,
                header: true, // Očekáváme, že CSV má hlavičku (Device, Component, Price)
                skipEmptyLines: true,
                // Funkce pro sledování průběhu stahování
                downloadRequest: (xhr) => {
                    xhr.addEventListener('progress', (event) => {
                        if (event.lengthComputable) {
                            const percentComplete = Math.round((event.loaded / event.total) * 100);
                            updateProgressBar(percentComplete);
                        }
                    });
                },
                // Funkce, která se zavolá po dokončení zpracování
                complete: (results) => {
                    // Ujistíme se, že je progress bar na 100%
                    updateProgressBar(100);
                    
                    // Uložíme data a inicializujeme aplikaci
                    repairData = results.data;
                    
                    // Krátké zpoždění pro plynulý přechod
                    setTimeout(initializeApp, 500);
                },
                // Funkce pro ošetření chyb
                error: (error) => {
                    console.error("Chyba při načítání CSV:", error);
                    loadingSection.innerHTML = `<p class="text-red-500 text-center font-bold">Nepodařilo se načíst data. Zkontrolujte prosím URL adresu a formát CSV souboru.</p>`;
                }
            });
        }

        /**
         * Aktualizuje vizuální stav načítací lišty.
         * @param {number} percentage - Procentuální hodnota (0-100).
         */
        function updateProgressBar(percentage) {
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${percentage}%`;
        }

        /**
         * Inicializuje aplikaci po načtení dat.
         * Skryje načítací sekci a zobrazí hlavní obsah.
         * Naplní dropdown unikátními názvy zařízení.
         */
        function initializeApp() {
            loadingSection.classList.add('hidden');
            appContent.classList.remove('hidden');

            // Získáme unikátní názvy zařízení
            const devices = [...new Set(repairData.map(item => item.Device))];
            
            // Seřadíme zařízení abecedně
            devices.sort();

            // Naplníme dropdown menu
            devices.forEach(device => {
                const option = document.createElement('option');
                option.value = device;
                option.textContent = device;
                deviceSelect.appendChild(option);
            });
        }

        /**
         * Zobrazí tabulku s cenami pro vybrané zařízení.
         * @param {string} selectedDevice - Název vybraného zařízení.
         */
        function displayPricesForDevice(selectedDevice) {
            // Vymažeme předchozí výsledky
            resultContainer.innerHTML = '';

            if (!selectedDevice) {
                return; // Pokud není nic vybráno, nic nezobrazujeme
            }

            // Vyfiltrujeme data pouze pro vybrané zařízení
            const devicePrices = repairData.filter(item => item.Device === selectedDevice);

            // Vytvoříme HTML pro zobrazení výsledků
            const resultHTML = `
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Ceník pro: <span class="text-blue-600">${selectedDevice}</span></h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Komponenta</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Cena opravy</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${devicePrices.map(item => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.Component}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-right font-semibold">${item.Price}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            resultContainer.innerHTML = resultHTML;
        }

        // --- SPUŠTĚNÍ A LISTENERY ---

        // Přidáme listener na změnu v dropdown menu
        deviceSelect.addEventListener('change', (event) => {
            displayPricesForDevice(event.target.value);
        });

        // Spustíme načítání dat po načtení stránky
        document.addEventListener('DOMContentLoaded', fetchData);

    </script>
</body>
</html>
